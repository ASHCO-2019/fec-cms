{% extends "embed.html" %}
{% load wagtailcore_tags %}
{% load filters %}
{#% import "macros/bythenumbers-embed-macro.jinja" as breakdowns %#}
{#% import 'macros/cycle-select.jinja' as select %#}
{#% import 'macros/categories.jinja' as category_select %#}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% asset_for_css 'base.css' %}">
    <link rel="stylesheet" type="text/css" href="{% asset_for_css 'data-landing.css' %}">
{% endblock %}

{% block page_title %}
  <h1 class="icon-heading--raising-circle">TEST{{ title }}</h1>
{% endblock %}


{% block content %}
<h2 class="heading--section u-margin--bottom">Who is raising and spending the most</h2>
<div class="grid grid--2-wide grid--flex">
  <div class="grid__item">
  <section id="raising-breakdowns">
  <section id="top-raisers" class="content__section">
    <h2>Who's raising the most</h2>



    {# replacing macro with hard code#}
    <div class="js-top-entities content__section" data-category="{{ category }}" data-cycle="{{ cycle }}"" data-perpage="{{ per_page }}">
  <span class="t-sans js-dates">{{ coverage_start_date|date }} to {{ coverage_end_date|date }}</span>
  <div class="chart-table simple-table--responsive js-top-table" id="top-table" aria-live="polite" role="grid">
    <div role="row" class="simple-table__header">
      <div role="columnheader" class="simple-table__header-cell cell--40">Name</div>
      <div role="columnheader" class="simple-table__header-cell cell--20 t-right-aligned">Total {{ action }}</div>
      <div role="columnheader" class="simple-table__header-cell cell--40"></div>
    </div>
  {% for datum in data %}
    <div role="row" class="js-top-row simple-table__row">
      <div role="gridcell" class="simple-table__cell">{{ loop.index }}.
        <a href="/data/{{ route }}/{{ datum.id_field }}/?cycle={{ cycle }}&election_full=false" title="{{ datum.name_field }}">{{ datum.name_field }}</a>
        {% if datum.party %}
          [{{ datum.party }}]
        {% endif %}
      </div>
      <div class="simple-table__cell t-right-aligned">{{ datum.value_field  }}</div>
      <div class="simple-table__cell">
        <div class="bar-container">
          <div class="value-bar" data-value="{{ datum.value_field }}" data-party="{{ datum.party }}"></div>
        </div>
      </div>
    </div>
  {% endfor %}
  </div>
  <div class="results-info">
    <button class="js-previous button button--standard button--previous"><span class="u-visually-hidden">Previous page</span></button>
    <button class="js-next button button--standard button--next"><span class="u-visually-hidden">Next page</span></button>
    <div class="u-float-right t-sans">
      Showing <span class="js-page-info">{{ page_info }}</span> entries
    </div>
  </div>
</div>
<div class="content__section row">
  <ul class="list--buttons u-float-right">
    <li><a class="button button--standard button--table" href="/data/{{ value_field }}">Browse {{value_field}}</a></li>
    <li><button class="button button--alt js-ga-event"  data-a11y-dialog-show="{{ action }}-modal" data-ga-event="{{ action }} methodology modal clicked" aria-controls="{{ action }}-modal">Methodology</button></li>
  </ul>
</div>
    {# END replacing macro with hard code#}


  </section>
</section>
</div>
<div class="grid__item example--primary">
  <div id="data-type-toggle" class="filters__inner data-type">
    <fieldset class="filter toggles js-filter js-table-switcher" data-filter="toggle" data-filter-ignore-count="true">
    <legend class="label t-inline-block">Data type</legend>
    <div class="row">
      <label for="switcher-processed" class="toggle">
        <input type="radio" class="chart_toggle" value="raising" id="switcher-processed" checked="" name="data_type" data-prefix="Data type:" data-tag-value="processed" aria-controls="processed-message" tabindex="0">
        <span class="button--alt">Raised</span>
      </label>
      <label for="switcher-efilings" class="toggle">
        <input type="radio" class="chart_toggle" value="spending" id="switcher-efilings" name="data_type" data-prefix="Data type:" data-tag-value="raw" aria-controls="efiling-message" tabindex="0">
        <span class="button--alt">Spent</span>
      </label>
    </div>


<form action="" method="get">

{# hardcode category macro #}
<div class="js-top-entities">
      <label for="top-category" class="breakdown__title label">How much has been {{ action }} by </label>
      <select id="top-category" name="top_category" class="js-category form-element--inline" aria-controls="top-table">
        <optgroup label="Candidates">
          <option value="P" {% if category == 'P' %}selected{% endif %}>Presidential candidates</option>
          <option value="S" {% if category == 'S' %}selected{% endif %}>Senate candidates</option>
          <option value="H" {% if category == 'H' %}selected{% endif %}>House candidates</option>
        </optgroup>
        <option value="pac" {% if category == 'pac' %}selected{% endif %}>PACs</option>
        <option value="party" {% if category == 'party' %}selected{% endif %}>Political party committees</option>
      </select>
 </div>
{# END hardcode category macro #}

<noscript>
        <button type="submit" class="button button--cta">Submit</button>
</noscript>
</form>


<form action="" method="get" class="breakdown-cycle">

{# temporarily remove cycle.select macro with hard code#}

<div class="cycle-select js-cycle-select">
    <label for="{{ id }}" class="label cycle-select__label">{{ label }}</label>
    <select
        id="{{ id }}"
        class="{{ class }} js-cycle"
        name="cycle"
        data-cycle-location="{{ location }}"
        data-duration="{{ duration }}"
    >
    {% for each in cycles  %}
        <option
          value="{{ each }}"
          {% if cycle and cycle <= each  %}selected{% endif %}
        >
        {% if range %}
          {{ each }}
        {% else %}
          {{ each }}
        {% endif %}
      </option>
    {% endfor %}
    </select>
  </div>

{# END temporarily remove cycle.select macro with hard code#}

<noscript>
    <button type="submit" class="button button--cta">Submit</button>
  </noscript>
</form>

</div>
</div>
{% endblock %}

{% block modals %}
<div class="js-modal modal" id="raised-modal" aria-hidden="true">
  <div tabindex="-1" class="modal__overlay" data-a11y-dialog-hide></div>
  <div role="dialog" class="modal__content" aria-labelledby="raised-modal-title">
    <div role="document">
      <button type="button" class="modal__close button--close--primary" data-a11y-dialog-hide title="Close this dialog window"></button>
      <h2 id="raised-modal-title">Methodology</h2>
      <p>Committees are displayed in descending order of total <span class="term" data-term="receipt">receipts</span>. Total receipts are the sum of all contributions and other receipts received by a committee.</p>
      <p>This chart includes data up to and including the most recent report filed by each committee. It's displayed in two-year cycles.</p>
      <p>The form and line used to calculate total receipt sums are:</p>
      <ul class="list--bulleted">
        <li>Presidential committees: Form 3P, Line 22, Column A</li>
        <li>Senate and House committees: Form 3, Line 16, Column A</li>
        <li>PACs and party committees: Form 3X, Line 20, Column A</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
   <script type="text/javascript">
  var context = {
    type: 'receipts'
  }
  // setTimeout(function(){
  //   $('#top-category').val("P").trigger('change')
  //    console.log("TC"+('#top-category').value)
  //  }, 3000);
  $(function(){
    $('#top-category').val("P").trigger('change')
     console.log("TC"+('#top-category').value)
  })
  </script>

  <script src="{% asset_for_js 'bythenumbers.js' %}"></script>
{% endblock %}
